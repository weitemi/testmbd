/*
 * CAN.c
 *
 *  Created on: 2018年8月20日
 *      Author: Administrator
 */

#include "Cpu.h"
#include "clockMan1.h"
#include "pin_mux.h"
#include "SYS.h"
#include "CAN.h"
#include <stdint.h>
#include <stdbool.h>
#include <stddef.h>
#include "S32K144.h"


 can_buff_config_t buffCfg =  {
     .enableFD = false,
     .enableBRS = true,
     .fdPadding = 0U,
     .idType = CAN_MSG_ID_EXT,
     .isRemote = false
 };
void CAN0_Ini(void)
{

	CAN_Init(INST_CAN_PAL0, &can_pal0_Config0);


    /* Configure TX buffer with index TX_MAILBOX*/
    CAN_ConfigTxBuff(INST_CAN_PAL0, CAN0_TX_MAILBOX0, &buffCfg);
    CAN_ConfigTxBuff(INST_CAN_PAL0, CAN0_TX_MAILBOX1, &buffCfg);
    CAN_ConfigTxBuff(INST_CAN_PAL0, CAN0_TX_MAILBOX2, &buffCfg);
    CAN_ConfigTxBuff(INST_CAN_PAL0, CAN0_TX_MAILBOX3, &buffCfg);

    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_REL, &buffCfg, ID_REL);//继电器控制报文ID
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_CBD, &buffCfg, ID_CBD);//参数标定报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_GBD, &buffCfg, ID_GBD);//故障标定报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_RW, &buffCfg, ID_GU_RW);//握手报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_DC_MAN, &buffCfg, ID_DC_MAN);//DC手动控制
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_JYFBD, &buffCfg, ID_REC_JYFBD);//喷轨控制器信息标定
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_KQBYF_QXHB_PUMP_MAN, &buffCfg, ID_KQBYF_QXHB_PUMP_MAN);//背压阀、氢气循环泵、电子水泵手动控制报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_SJKYJ_MAN, &buffCfg, ID_SJKYJ_MAN);//势加透博空压机手动控制报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_JWQ_PTC_6KWDC_MAN, &buffCfg, ID_JWQ_PTC_6KWDC_MAN);//节温器、PTC、6KW降压DC手动控制报文

    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_Pump, &buffCfg, ID_REC_Pump);//电子水泵报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_H_Pump, &buffCfg, ID_REC_H_Pump);//北京艾尔氢气循环泵报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_JYF, &buffCfg, ID_REC_JYF);//喷轨控制器报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_KQBYF, &buffCfg, ID_REC_KQBYF);//背压阀报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_SJKYJ1, &buffCfg, ID_REC_SJKYJ1);//势加透波空压报文1
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_SJKYJ2, &buffCfg, ID_REC_SJKYJ2);//势加透波空压报文2
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_DC, &buffCfg, ID_REC_DC);//福瑞升压DC报文1
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_DC2, &buffCfg, ID_REC_DC2);//福瑞升压DC报文2
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_CVM11, &buffCfg, ID_CVM11);//柴克CVM采集器1报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_CVM12, &buffCfg, ID_CVM12);//柴克CVM采集器1报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_CVM21, &buffCfg, ID_CVM21);//柴克CVM采集器6报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_CVM22, &buffCfg, ID_CVM22);//柴克CVM采集器6报文
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_6KWDCDC1, &buffCfg, ID_6KWDCDC1);//降压DCDC1
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_ThreeWayValve, &buffCfg, ID_ThreeWayValve);//欧冠机电三通阀
    CAN_ConfigRxBuff(INST_CAN_PAL0, RX_MAILBOX_PTC, &buffCfg, ID_PTC);//PTC加热器




    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_REL, &recvMsg_REL);//继电器控制报文ID
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_CBD, &recvMsg_CBD);//参数标定报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_GBD, &recvMsg_GBD);//故障标定报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_RW, &recvMsg_RW);//握手报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_DC_MAN, &recvMsg_DC_MAN);//DC手动控制
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_JYFBD, &recvMsg_JYFBD);//喷轨控制器信息标定
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_KQBYF_QXHB_PUMP_MAN, &recvMsg_KQBYF_QXHB_PUMP_MAN);//背压阀、氢气循环泵、电子水泵手动控制报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_SJKYJ_MAN, &recvMsg_SJKYJ_MAN);//势加透博空压机手动控制报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_JWQ_PTC_6KWDC_MAN, &recvMsg_JWQ_PTC_6KWDC_MAN);//节温器、PTC、6KW降压DC手动控制报文

    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_Pump, &recvMsg_Pump);//电子水泵报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_H_Pump, &recvMsg_H_Pump);//北京艾尔氢气循环泵报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_JYF, &recvMsg_JYF);//喷轨控制器报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_KQBYF, &recvMsg_KQBYF);//背压阀报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_SJKYJ1, &recvMsg_SJKYJ1);//势加透波空压报文1
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_SJKYJ2, &recvMsg_SJKYJ2);//势加透波空压报文2
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_DC, &recvMsg_DC);//福瑞升压DC报文1
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_DC2, &recvMsg_DC2);//福瑞升压DC报文2
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_CVM11, &recvMsg_CVM11);//柴克CVM采集器1报文
    CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_CVM12, &recvMsg_CVM12);//柴克CVM采集器1报文
	CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_CVM21, &recvMsg_CVM21);//柴克CVM采集器6报文
	CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_CVM22, &recvMsg_CVM22);//柴克CVM采集器6报文
	CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_6KWDCDC1, &recvMsg_6KWDCDC1);//降压DCDC1
	CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_ThreeWayValve, &recvMsg_ThreeWayValve);//三通阀
	CAN_Receive(INST_CAN_PAL0, RX_MAILBOX_PTC, &recvMsg_PTC);//PTC

}

void REN_CAN_Send(uint32_t ID,uint32_t MAILBOX_ID,uint8_t Data0,uint8_t Data1,uint8_t Data2,uint8_t Data3,
		uint8_t Data4,uint8_t Data5,uint8_t Data6,uint8_t Data7)
{
	TX_message.cs = 0U;
	TX_message.id = ID;
	TX_message.data[0]=Data0;
	TX_message.data[1]=Data1;
	TX_message.data[2]=Data2;
	TX_message.data[3]=Data3;
	TX_message.data[4]=Data4;
	TX_message.data[5]=Data5;
	TX_message.data[6]=Data6;
	TX_message.data[7]=Data7;
	TX_message.length = 8U;
    CAN_Send(INST_CAN_PAL0, MAILBOX_ID, &TX_message);

}

